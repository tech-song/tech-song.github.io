---
title: MySQL主从架构详解
description: 
date: 2025-04-21 22:37:00 +0800
categories: [MySQL]
tags: [MySQL]
author: 宋科技
---
# 基本架构概览

![MySQL基础架构图](/assets/imgs/MySQL基础架构图.png)

简单来说，MySQL主要分为**Server层**和**存储引擎层**。

**Server层**包括：连接器、查询缓存（MySQL8.0移除）、分析器、优化器、执行器等。所有跨存储引擎的功能都在Server层实现，比如存储过程、触发器、视图、函数等，还包括一个通用的binlog日志模块。

**存储引擎**负责数据的存储和读取，采用可替换的插件式架构，支持InnoDB、MyISAM、Memory等存储引擎，目前最常用的存储引擎是InnoDB。

# Server层各组件介绍

## 1. 连接器

连接器负责管理客户端与 MySQL 服务端之间的连接。

- 当客户端发起连接时，连接器会验证用户名、密码，并检查是否有权限连接。

- 认证成功后，连接器为该客户端创建一个连接，并分配一个线程进行处理。

- 如果启用了连接池，连接器还会维护连接的复用，提高效率。

- `SHOW PROCESSLIST` 可以查看当前连接状态。

## 2. 查询缓存

注：MySQL 8.0 之后已废弃该模块！

- 查询缓存会保存一条 SQL 查询及其结果集。

- 如果后续有完全相同的 SQL 查询，且数据没有更新，可以直接从缓存中读取结果，避免重复执行。

- 查询缓存命中率低时反而会拖慢性能，因为更新表时还要清除缓存。

## 3. 分析器（Parser）

负责对 SQL 语句进行词法和语法分析，判断 SQL 是否符合语法规则。

- 会将 SQL 解析成解析树（Parse Tree），为后续处理做好准备。

- 比如分析 SQL 语句:

```sql
SELECT id, name FROM users WHERE id = 1
```

要识别出这是一个查询语句、表是 `user`、条件是 `id = 1`。

- 如果 SQL 语法错误，会在这一步报错。

## 4. 优化器（Optimizer）

优化器决定 SQL 语句的执行方式（执行计划）。

- 可能存在多种执行方案（例如是否走索引、联表顺序等），优化器会尝试选择成本最小的方案。

- 会考虑的因素包括：是否使用索引、数据量大小、统计信息、排序方法等。

- 可以使用 EXPLAIN 命令查看优化器的选择结果。

## 5. 执行器（Executor）

执行器负责按照优化器给出的执行计划 一步步访问数据并返回结果。

- 首先会进行权限检查，确保用户对目标表有 SELECT、UPDATE 等权限；

- 根据执行计划，调用存储引擎读取数据、进行计算和返回；

- 最终结果返回给客户端，事务控制、锁处理等也会在执行器配合完成。


# SQL语句执行流程
客户端 → 连接器 → 查询缓存 → 分析器 → 优化器 → 执行器 → 存储引擎 → 返回结果
